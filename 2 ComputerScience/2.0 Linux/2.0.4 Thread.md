# Thread

## Предисловие

В мире операционных систем существуют две сущности, где запускаются наши программы (некие капсулы запуска прогармм) - **[процессы](./2.0.3%20Process.md) (изолированы друг от друга)**,**потоки (thread) (обмениваются данными почти бесплатно)**. Каждое приложение состоит как минимум из 1 [процесс](./2.0.3%20Process.md) - чаще всего только один. А процесс состоит хотя бы из 1 потока (main). 

![](https://www.w3.org/People/Frystyk/thesis/MultiStackThread.gif)

## История

Потоки POSIX

В конце 1980-х и начале 1990-х было несколько разных API, но в 1995 г. POSIX.1c стандартизовал потоки POSIX, позже это стало частью спецификаций SUSv3. В наше время многоядерные процессоры проникли даже в настольные ПК и смартфоны, так что даже у большинства машин есть низкоуровневая аппаратная поддержка, позволяющая им одновременно выполнять несколько потоков. В былые времена одновременное исполнение потоков на одноядерных ЦПУ было лишь впечатляюще изобретательной, но очень эффективной иллюзией.

## Поток

Поток можно считать меньшей единицей выполнения приложения. Каждому приложению принадлежит минимум один поток, который называется основным (main thread). Этот поток запускается [операционной системой](/2%20ComputerScience/2.0%20Linux/2.0.1%20Linux.md), когда вызывается метод main() приложения; это происходит при старте приложения. Заметьте, что более-менее одно и то же происходит на всех поддерживаемых платформах — как работающих на мощных компьютерах, так и на устройствах под управлением Windows Phone с ограниченными вычислительными ресурсами.

При вызове какого-либо метода операция добавляется в очередь. Каждая операция выполняется последовательно, в соответствии с порядком, в котором она была добавлена в очередь (хотя на порядок выполнения операций можно повлиять, назначив им приоритеты).

Все потоки разделяют общие ресурсы потока (память, файловые дескрипторы, процессорное время). У каждого потока есть свой [стэк](/3%20Memory%20and%20Concurrency/3.1%20Memory/3.1.1%20RandomAccessMemory/3.1.1.2%20Stack.md) (областья память, куда сохраняются локальные переменные функции, пока эта функция сохраняется). 

Управление потоками необходимо чтобы: 
1) сделать приложение быстрым, предотвратить зависающий UI, реагировать на действия пользователей без задержки; 
2) параллельно обрабатывать данные; 

> ❗ Мы не можем использовать больше потоков, чем ядер у нашего процессора. 

При написании многопоточных приложений требуется работать с общими данными из разных потоков. 

### Thread

> Posix Threads или Pthreads определяет набор типов и функций на Си.

Pthreads - самый низкий уровень управления потоками, доступные в приложении. Он дает почти прямой доступ к управлению потоками ядра OS. В swift эта бибилиотека обычно не используется из-за сложности и необходимости рабоыт с указателями. 